<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Itinerary Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            .print-break { page-break-inside: avoid; }
            body { background: white !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script>
        const e = React.createElement;
        const { useState } = React;

        function App() {
            const [days, setDays] = useState([{
                id: 1, date: '2026-02-15', title: 'Day 1', expanded: true,
                entries: [{
                    id: 1, time: '09:00', title: 'Sample Activity', notes: '', cost: 0,
                    currency: 'USD', category: 'other', duration: 60, travelTime: 0,
                    distance: '', mapLink: '', attachments: []
                }]
            }]);

            const [tripTitle, setTripTitle] = useState('My Travel Itinerary');
            const [editingTitle, setEditingTitle] = useState(false);
            const [editingDay, setEditingDay] = useState(null);
            const [editingEntry, setEditingEntry] = useState(null);
            const [totalBudget, setTotalBudget] = useState(2000);
            const [budgetCurrency, setBudgetCurrency] = useState('USD');
            const [showChecklist, setShowChecklist] = useState(false);
            const [checklist, setChecklist] = useState([
                { id: 1, task: 'Apply for visa', completed: false },
                { id: 2, task: 'Get vaccinations', completed: false },
                { id: 3, task: 'Purchase travel insurance', completed: false },
                { id: 4, task: 'Book SIM card / eSIM', completed: false }
            ]);

            const categories = {
                food: { label: 'Food', color: 'bg-orange-500', icon: 'ðŸ½ï¸' },
                transport: { label: 'Transport', color: 'bg-blue-500', icon: 'ðŸš—' },
                activities: { label: 'Activities', color: 'bg-green-500', icon: 'ðŸŽ¯' },
                accommodation: { label: 'Accommodation', color: 'bg-purple-500', icon: 'ðŸ¨' },
                shopping: { label: 'Shopping', color: 'bg-pink-500', icon: 'ðŸ›ï¸' },
                other: { label: 'Other', color: 'bg-gray-500', icon: 'ðŸ“Œ' }
            };

            const calculateDayTotal = (day) => day.entries.reduce((sum, e) => sum + e.cost, 0);
            const calculateTripTotal = () => days.reduce((sum, d) => sum + calculateDayTotal(d), 0);
            const calculateCategoryTotals = () => {
                const totals = {};
                days.forEach(d => d.entries.forEach(e => {
                    const cat = e.category || 'other';
                    totals[cat] = (totals[cat] || 0) + e.cost;
                }));
                return totals;
            };

            const formatDuration = (mins) => {
                if (!mins) return '0m';
                const h = Math.floor(mins / 60), m = mins % 60;
                return h === 0 ? `${m}m` : m === 0 ? `${h}h` : `${h}h ${m}m`;
            };

            const tripTotal = calculateTripTotal();
            const categoryTotals = calculateCategoryTotals();
            const budgetRemaining = totalBudget - tripTotal;
            const budgetPercentage = totalBudget > 0 ? (tripTotal / totalBudget) * 100 : 0;

            return e('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 print:bg-white print:p-0' },
                e('div', { className: 'max-w-4xl mx-auto' },
                    // Header
                    e('div', { className: 'bg-white rounded-lg shadow-lg p-4 mb-4' },
                        e('div', { className: 'mb-4' },
                            editingTitle ? 
                                e('div', { className: 'flex items-center gap-2' },
                                    e('input', {
                                        type: 'text',
                                        value: tripTitle,
                                        onChange: (ev) => setTripTitle(ev.target.value),
                                        className: 'text-2xl font-bold border-b-2 border-indigo-500 outline-none flex-1'
                                    }),
                                    e('button', {
                                        onClick: () => setEditingTitle(false),
                                        className: 'text-indigo-600 px-2 py-1'
                                    }, 'âœ“')
                                ) :
                                e('div', { className: 'flex items-center gap-2' },
                                    e('h1', { className: 'text-2xl font-bold' }, tripTitle),
                                    e('button', {
                                        onClick: () => setEditingTitle(true),
                                        className: 'text-gray-400'
                                    }, 'âœï¸')
                                )
                        ),
                        
                        // Buttons
                        e('div', { className: 'flex gap-2 mb-4 no-print' },
                            e('button', {
                                onClick: () => setShowChecklist(true),
                                className: 'flex-1 bg-indigo-500 text-white px-3 py-2 rounded'
                            }, `âœ“ Checklist (${checklist.filter(i => i.completed).length}/${checklist.length})`),
                            e('button', {
                                onClick: () => window.print(),
                                className: 'flex-1 bg-gray-600 text-white px-3 py-2 rounded'
                            }, 'ðŸ–¨ï¸ Print')
                        ),

                        // Budget Cards
                        e('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-3 mb-4' },
                            e('div', { className: 'bg-indigo-500 rounded-lg p-3 text-white' },
                                e('div', { className: 'text-xs mb-1' }, 'Budget'),
                                e('input', {
                                    type: 'number',
                                    value: totalBudget,
                                    onChange: (ev) => setTotalBudget(parseFloat(ev.target.value) || 0),
                                    className: 'w-full bg-white/20 text-white rounded px-2 py-1 text-sm'
                                })
                            ),
                            e('div', { className: 'bg-green-500 rounded-lg p-3 text-white' },
                                e('div', { className: 'text-xs mb-1' }, 'Spent'),
                                e('div', { className: 'font-bold' }, `${budgetCurrency} ${tripTotal.toFixed(2)}`)
                            ),
                            e('div', { className: `${budgetRemaining >= 0 ? 'bg-blue-500' : 'bg-red-500'} rounded-lg p-3 text-white` },
                                e('div', { className: 'text-xs mb-1' }, 'Remaining'),
                                e('div', { className: 'font-bold' }, `${budgetCurrency} ${Math.abs(budgetRemaining).toFixed(2)}`)
                            ),
                            e('div', { className: 'bg-orange-500 rounded-lg p-3 text-white' },
                                e('div', { className: 'text-xs mb-1' }, 'Days'),
                                e('div', { className: 'font-bold' }, days.length)
                            )
                        ),

                        // Budget Progress
                        e('div', { className: 'mb-4' },
                            e('div', { className: 'w-full bg-gray-200 rounded-full h-3' },
                                e('div', {
                                    className: `h-full rounded-full ${budgetPercentage <= 50 ? 'bg-green-500' : budgetPercentage <= 80 ? 'bg-yellow-500' : 'bg-red-500'}`,
                                    style: { width: `${Math.min(budgetPercentage, 100)}%` }
                                })
                            )
                        ),

                        // Categories
                        e('div', null,
                            e('h3', { className: 'text-sm font-bold mb-2' }, 'Categories'),
                            e('div', { className: 'grid grid-cols-3 gap-2' },
                                Object.entries(categories).map(([key, cat]) => {
                                    const total = categoryTotals[key] || 0;
                                    return e('div', { key, className: 'bg-gray-50 rounded p-2 border' },
                                        e('div', { className: 'text-lg' }, cat.icon),
                                        e('div', { className: 'text-xs' }, cat.label),
                                        e('div', { className: 'font-bold text-sm' }, `${budgetCurrency} ${total.toFixed(2)}`)
                                    );
                                })
                            )
                        )
                    ),

                    // Checklist Modal
                    showChecklist && e('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4' },
                        e('div', { className: 'bg-white rounded-lg max-w-md w-full p-6' },
                            e('div', { className: 'flex justify-between mb-4' },
                                e('h2', { className: 'text-xl font-bold' }, 'Checklist'),
                                e('button', {
                                    onClick: () => setShowChecklist(false),
                                    className: 'text-gray-400'
                                }, 'âœ•')
                            ),
                            e('div', { className: 'space-y-2 mb-4' },
                                checklist.map(item => e('div', {
                                    key: item.id,
                                    className: 'flex items-center gap-3 p-2 hover:bg-gray-50 rounded'
                                },
                                    e('input', {
                                        type: 'checkbox',
                                        checked: item.completed,
                                        onChange: () => setChecklist(checklist.map(i => 
                                            i.id === item.id ? {...i, completed: !i.completed} : i
                                        )),
                                        className: 'w-5 h-5'
                                    }),
                                    e('span', {
                                        className: item.completed ? 'line-through text-gray-400' : ''
                                    }, item.task)
                                ))
                            ),
                            e('button', {
                                onClick: () => {
                                    const task = prompt('Enter new task:');
                                    if (task) setChecklist([...checklist, { id: Date.now(), task, completed: false }]);
                                },
                                className: 'w-full bg-indigo-500 text-white py-2 rounded'
                            }, '+ Add Task')
                        )
                    ),

                    // Days
                    e('div', { className: 'space-y-4' },
                        days.map(day => e('div', {
                            key: day.id,
                            className: 'bg-white rounded-lg shadow-md overflow-hidden'
                        },
                            // Day Header
                            e('div', { className: 'bg-indigo-500 p-4 text-white' },
                                e('div', { className: 'flex justify-between items-center' },
                                    e('div', { className: 'flex items-center gap-2' },
                                        e('button', {
                                            onClick: () => setDays(days.map(d => 
                                                d.id === day.id ? {...d, expanded: !d.expanded} : d
                                            )),
                                            className: 'no-print'
                                        }, day.expanded ? 'â–¼' : 'â–¶'),
                                        editingDay === day.id ?
                                            e('input', {
                                                type: 'text',
                                                value: day.title,
                                                onChange: (ev) => setDays(days.map(d => 
                                                    d.id === day.id ? {...d, title: ev.target.value} : d
                                                )),
                                                className: 'bg-white text-gray-800 px-2 py-1 rounded'
                                            }) :
                                            e('h2', { className: 'text-xl font-bold' }, day.title)
                                    ),
                                    e('div', { className: 'flex items-center gap-2' },
                                        e('div', { className: 'text-right' },
                                            e('div', { className: 'text-xs' }, 'Day Total'),
                                            e('div', { className: 'font-bold' }, `${budgetCurrency} ${calculateDayTotal(day).toFixed(2)}`)
                                        ),
                                        e('button', {
                                            onClick: () => setDays(days.map(d => {
                                                if (d.id === day.id) {
                                                    return {...d, entries: [...d.entries, {
                                                        id: Date.now(), time: '09:00', title: 'New Activity',
                                                        notes: '', cost: 0, currency: 'USD', category: 'other',
                                                        duration: 60, travelTime: 0, distance: '', mapLink: '', attachments: []
                                                    }]};
                                                }
                                                return d;
                                            })),
                                            className: 'bg-white text-indigo-600 px-3 py-1 rounded no-print'
                                        }, '+ Entry'),
                                        e('button', {
                                            onClick: () => setDays(days.filter(d => d.id !== day.id)),
                                            className: 'no-print'
                                        }, 'âœ•')
                                    )
                                )
                            ),

                            // Entries
                            day.expanded && e('div', { className: 'p-4' },
                                day.entries.length === 0 ? 
                                    e('p', { className: 'text-gray-400 text-center py-8' }, 'No entries') :
                                    e('div', { className: 'space-y-4' },
                                        day.entries.sort((a, b) => a.time.localeCompare(b.time)).map(entry => {
                                            const catColor = categories[entry.category || 'other']?.color || 'bg-gray-500';
                                            return e('div', {
                                                key: entry.id,
                                                className: `bg-gray-50 rounded-lg p-4 border-l-4 ${catColor.replace('bg-', 'border-')}`
                                            },
                                                e('div', { className: 'flex justify-between mb-2' },
                                                    e('div', null,
                                                        editingEntry === entry.id ?
                                                            e('input', {
                                                                type: 'text',
                                                                value: entry.title,
                                                                onChange: (ev) => setDays(days.map(d => d.id === day.id ? {
                                                                    ...d,
                                                                    entries: d.entries.map(e => e.id === entry.id ? {...e, title: ev.target.value} : e)
                                                                } : d)),
                                                                className: 'font-bold border rounded px-2 py-1'
                                                            }) :
                                                            e('h3', { className: 'font-bold' }, entry.title),
                                                        e('div', { className: 'text-xs text-gray-500' }, 
                                                            `${categories[entry.category]?.icon || 'ðŸ“Œ'} ${entry.time}`
                                                        )
                                                    ),
                                                    e('div', { className: 'flex gap-2 no-print' },
                                                        e('button', {
                                                            onClick: () => setEditingEntry(editingEntry === entry.id ? null : entry.id)
                                                        }, editingEntry === entry.id ? 'âœ“' : 'âœï¸'),
                                                        e('button', {
                                                            onClick: () => setDays(days.map(d => d.id === day.id ? {
                                                                ...d,
                                                                entries: d.entries.filter(e => e.id !== entry.id)
                                                            } : d))
                                                        }, 'âœ•')
                                                    )
                                                ),
                                                entry.notes && e('p', { className: 'text-sm text-gray-600 mb-2' }, entry.notes),
                                                e('div', { className: 'grid grid-cols-2 gap-2 text-sm' },
                                                    e('div', null, `ðŸ’° ${entry.currency} ${entry.cost.toFixed(2)}`),
                                                    e('div', null, `â±ï¸ ${formatDuration(entry.duration)}`),
                                                    entry.travelTime > 0 && e('div', null, `ðŸš— ${formatDuration(entry.travelTime)}`),
                                                    entry.distance && e('div', null, `ðŸ“ ${entry.distance}`)
                                                ),
                                                entry.mapLink && e('a', {
                                                    href: entry.mapLink,
                                                    target: '_blank',
                                                    className: 'text-indigo-600 text-sm mt-2 inline-block'
                                                }, 'ðŸ—ºï¸ Open Map')
                                            );
                                        })
                                    )
                            )
                        ))
                    ),

                    // Add Day Button
                    e('button', {
                        onClick: () => setDays([...days, {
                            id: Date.now(),
                            date: new Date().toISOString().split('T')[0],
                            title: `Day ${days.length + 1}`,
                            expanded: true,
                            entries: []
                        }]),
                        className: 'mt-6 w-full bg-indigo-500 text-white py-3 rounded-lg font-bold no-print'
                    }, '+ Add Day')
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(App));
    </script>
</body>
</html>